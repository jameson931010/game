<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <title>game</title>
</head>
<body>
    <script>
    class Node {
        constructor(r, c) {
            this.row = r;
            this.column = c;
            this.bomb = false;
            this.checked = false;
        }
    }
    var endgame = false;
    var space = 36, bomb = 0;
    var graph = [[],[],[],[],[],[],[],[]];
    var checkqueue=[];
    function modify(row, column, tar) {
        var output = document.getElementById("square"+String(row)+String(column));
        output.innerHTML = tar;
        console.log(output);
    }
    function lose() {
        alert("you lose!!");
        endgame = true;
    }
    function win() {
        alert("you win!!");
        endgame = true;
    }
    function count(row, column) {
        var dx = [0, 0, 1, -1, 1, 1, -1, -1];
        var dy = [1, -1, 0, 0, 1, -1, 1, -1];
        var cnt = 0;
        for(var i=0; i<8; i++){
            var nx = row+dx[i], ny = column+dy[i];
            if(graph[nx][ny].bomb) {
                cnt++;
            }
        }
        if(cnt == 0) {
            for(var i=0; i<4; i++){
                var nx = row+dx[i], ny = column+dy[i];
                if(!(checkqueue.includes(graph[nx][ny]) || graph[nx][ny].checked)) {
                    
                    checkqueue.push(graph[nx][ny]);
                }
            }
        }
        return cnt;
    }
    function check(row, column, flag) {
console.log([row, column]);
        graph[row][column].checked = true;
        space--;
        if(flag == 1 && graph[row][column].bomb) {
            lose();
            return;
        }
        else {
            modify(row, column, count(row, column).toString());
            console.log(count(row, column));
            if(checkqueue.length > 0) {
                var index = checkqueue.pop();
                return check(index.row, index.column, 0);
            }
console.log(space);
            if(space == 0) {
                win();
            }
        }
    }

    function create() {
        for(var i=0; i<8; i++){
            for(var j=0; j<8; j++){
                graph[i][j] = new Node(i, j);
            }
        }
        for(var i=0; i<8; i++){
            graph[i][0].checked = true;
            graph[i][7].checked = true;
            graph[0][i].checked = true;
            graph[7][i].checked = true;
        }
        while(bomb < 4) {
            var br = Math.floor(Math.random()*6);
            var bc = Math.floor(Math.random()*6);
            if(!graph[br+1][bc+1].bomb) {
                bomb++;
                space--;
                graph[br+1][bc+1].bomb = true;
                graph[br+1][bc+1].checked = true;
            }
        }
        for(var i=1; i<=6; i++){
            for(var j=1; j<=6; j++){
                document.write("<button id=square"+String(i)+String(j)+" onclick=\"check("+String(i)+","+String(j)+",1)\" type=\"button\" style=\"width:80px; height:80px; border:1px solid black; background-color:white;\">?</button>");
            }
            document.write("<br/>")
        }
    }
    create();
console.log(graph);
    </script> 
    <script src="/play.js" />
</body>
